<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL PREDICTIONS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #3d2c5c 0%, #503d72 50%, #3d2c5c 100%); min-height: 100vh; padding: 2rem; color: white; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 3rem; }
        h1 { font-size: 3rem; margin-bottom: 0.5rem; }
        .subtitle { color: #d4c5f9; font-size: 1.2rem; }
        .api-setup { background: rgba(107, 79, 158, 0.3); border: 2px solid #6b4f9e; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem; }
        .api-setup input { width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: none; background: rgba(255, 255, 255, 0.1); color: white; font-size: 1rem; }
        .api-setup button { margin-top: 0.5rem; padding: 0.75rem 2rem; border-radius: 0.5rem; border: none; background: #6b4f9e; color: white; font-weight: bold; cursor: pointer; }
        .api-setup button:hover { background: #7c5caf; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 2rem; }
        .game-card { border-radius: 1.5rem; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.4); transition: transform 0.3s ease; }
        .game-card:hover { transform: translateY(-5px); }
        .game-header { padding: 2rem; }
        .game-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .game-time { font-weight: 600; }
        .badge { background: rgba(255,255,255,0.2); padding: 0.4rem 1rem; border-radius: 2rem; font-size: 0.85rem; font-weight: bold; }
        .confidence-high { background: #10b981; }
        .confidence-medium { background: #f59e0b; }
        .confidence-low { background: #ef4444; }
        .teams { display: flex; justify-content: space-between; align-items: center; }
        .team { display: flex; align-items: center; gap: 1rem; }
        .team-logo { width: 64px; height: 64px; }
        .team-name { font-size: 1.3rem; font-weight: bold; }
        .team-record { opacity: 0.8; font-size: 0.9rem; }
        .vs { font-size: 2rem; font-weight: bold; opacity: 0.8; }
        .game-body { padding: 2rem; background: rgba(31, 41, 55, 0.5); }
        .prediction-section { background: rgba(107, 79, 158, 0.3); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; }
        .prediction-title { color: #d4c5f9; font-size: 0.9rem; margin-bottom: 1rem; font-weight: 600; }
        .prediction-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .pred-stat { background: rgba(55, 65, 81, 0.5); padding: 1rem; border-radius: 0.75rem; text-align: center; }
        .pred-label { color: #9ca3af; font-size: 0.85rem; margin-bottom: 0.5rem; }
        .pred-value { font-size: 1.8rem; font-weight: bold; }
        .winner-section { text-align: center; margin-bottom: 1.5rem; }
        .winner-label { color: #9ca3af; font-size: 0.85rem; margin-bottom: 0.5rem; }
        .winner-name { font-size: 2rem; font-weight: bold; color: #10b981; }
        .confidence { font-size: 1rem; color: #d4c5f9; margin-top: 0.5rem; }
        .stats-breakdown { display: grid; gap: 0.75rem; }
        .stat-row { display: flex; justify-content: space-between; background: rgba(55, 65, 81, 0.3); padding: 0.75rem; border-radius: 0.5rem; }
        .loading { text-align: center; padding: 4rem; font-size: 1.5rem; }
        .error { background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem; text-align: center; display: none; }
        .sharp-pick { font-size: 1.5rem; font-weight: bold; color: #10b981; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèà NFL PREDICTIONS</h1>
            <p class="subtitle">Sharp Bets: Odds, Dimers Consensus, Weather, Injuries, Props</p>
        </header>

        <div class="api-setup" id="apiSetup">
            <h3>üîë The Odds API Key</h3>
            <p>Free: <a href="https://the-odds-api.com" target="_blank">the-odds-api.com</a></p>
            <input type="text" id="apiKeyInput" placeholder="Enter key" />
            <button onclick="saveApiKey()">Save & Load</button>
        </div>

        <div id="error" class="error"></div>
        <div id="loading" class="loading">Enter key...</div>
        <div id="games" class="games-grid"></div>
    </div>

    <script>
        const TEAM_DATA = { /* full as before */ };

        const GAME_DATA = {
            "Los Angeles Rams": { away: "Detroit Lions", dimersWinPct: 68, weather: "Dome", keyInjuries: "Lions secondary injuries", topProps: ["Rams -6", "Jahmyr Gibbs O rushing yds", "Davante Adams O rec yds"] },
            "Philadelphia Eagles": { away: "Las Vegas Raiders", dimersWinPct: 88, weather: "Possible snow 2-4in", keyInjuries: "Geno Smith out (shoulder)", topProps: ["Eagles -11.5", "Ashton Jeanty O rushing", "Jalen Hurts anytime TD"] },
            "Seattle Seahawks": { away: "Indianapolis Colts", dimersWinPct: 89, weather: "Dome", keyInjuries: "None major", topProps: ["Seahawks -13.5", "Jonathan Taylor U rushing yds", "JSN O rec"] },
            "Dallas Cowboys": { away: "Minnesota Vikings", dimersWinPct: 73, weather: "Dome", keyInjuries: "Justin Jefferson limited", topProps: ["Cowboys -5.5", "Javonte Williams O rushing", "CeeDee Lamb O rec yds"] },
            "Chicago Bears": { away: "Cleveland Browns", dimersWinPct: 78, weather: "Frigid 12¬∞F, no precip", keyInjuries: "None major", topProps: ["Bears team total O", "Shedeur Sanders O passing yds", "RB overs"] },
            "Kansas City Chiefs": { away: "Los Angeles Chargers", dimersWinPct: 71, weather: "Mild", keyInjuries: "Multiple OL out", topProps: ["Chiefs ML", "Mahomes O passing TD"] },
            "Buffalo Bills": { away: "New England Patriots", dimersWinPct: 57, weather: "Cold 30¬∞F, possible snow", keyInjuries: "None", topProps: ["James Cook O rushing", "Bills cover"] },
            "Pittsburgh Steelers": { away: "Miami Dolphins", dimersWinPct: 60, weather: "Cold", keyInjuries: "De‚ÄôVon Achane questionable", topProps: ["Steelers cover", "RB overs cold"] }
            // Add more as needed; code matches dynamically
        };

        let apiKey = localStorage.getItem('nfl_odds_api_key') || '';
        let teamStats = {};

        // saveApiKey, showError, loadAllData, fetchTeamStats, fetchGamesAndOdds same as last

        function generatePrediction(game, oddsGame) {
            const comp = game.competitions[0];
            const homeComp = comp.competitors.find(c => c.homeAway === 'home');
            const awayComp = comp.competitors.find(c => c.homeAway === 'away');
            const home = homeComp.team.displayName;
            const away = awayComp.team.displayName;

            // Odds parsing same

            let totalVal = total !== 'N/A' ? parseFloat(total) : 45;
            let spreadVal = spread !== 'N/A' ? parseFloat(spread) : 0;

            let homeScore = Math.round((totalVal + spreadVal) / 2); // Fixed: home favored if positive spread
            let awayScore = Math.round((totalVal - spreadVal) / 2);

            // Dimers
            let dimersPct = 50;
            const gData = GAME_DATA[home] || GAME_DATA[away];
            if (gData) {
                if (gData.away === away) dimersPct = gData.dimersWinPct;
                else if (GAME_DATA[away]?.away === home) dimersPct = 100 - GAME_DATA[away].dimersWinPct;
            }
            const dimersBias = (dimersPct - 50) / 50 * 3; // Adjust margin
            homeScore += Math.round(dimersBias);
            awayScore -= Math.round(dimersBias);

            // Cold weather adjustment
            homeScore -= 1; awayScore -= 1; // lower scores

            const margin = Math.abs(homeScore - awayScore);
            const winner = homeScore > awayScore ? home : away;
            const confidence = margin > 10 ? 'High' : margin > 5 ? 'Medium' : 'Low';

            return {
                home, away, homeScore, awayScore, winner, confidence, spread, total, homeML, awayML,
                beatsSpread: spread !== 'N/A' ? (homeScore - awayScore + parseFloat(spread) > 0 ? `${home} covers` : `${away} covers`) : 'N/A',
                homeQBYards: Math.round(homeScore * 11.5), homeQBTDs: Math.max(1, Math.floor(homeScore / 8.5)),
                awayQBYards: Math.round(awayScore * 11.5), awayQBTDs: Math.max(1, Math.floor(awayScore / 8.5)),
                homeRBYards: Math.round(homeScore * 5.2 + 30), awayRBYards: Math.round(awayScore * 5.2 + 30),
                dimersPct: dimersPct.toFixed(0),
                weather: gData?.weather || 'Variable',
                keyInjuries: gData?.keyInjuries || 'Check latest',
                topProps: gData?.topProps || ['Check lines']
            };
        }

        function createGameCard(game, pred) {
            const color = TEAM_DATA[pred.home]?.colors[0] || '#6b4f9e';
            const homeLogo = TEAM_DATA[pred.home]?.logo || '';
            const awayLogo = TEAM_DATA[pred.away]?.logo || '';
            const homeRecord = teamStats[pred.home]?.record || '';
            const awayRecord = teamStats[pred.away]?.record || '';
            const time = new Date(game.date).toLocaleString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });

            return `
                <div class="game-card" style="background: linear-gradient(135deg, ${color}22 0%, ${color}44 100%);">
                    <div class="game-header" style="background-color: ${color}ee;">
                        <div class="game-meta">
                            <div class="game-time">${time}</div>
                            <div class="badge confidence-${pred.confidence.toLowerCase()}">${pred.confidence.toUpperCase()}</div>
                        </div>
                        <div class="teams">
                            <div class="team">
                                ${awayLogo ? `<img src="${awayLogo}" class="team-logo">` : ''}
                                <div><div class="team-name">${pred.away}</div><div class="team-record">${awayRecord}</div></div>
                            </div>
                            <div class="vs">@</div>
                            <div class="team">
                                <div style="text-align: right;"><div class="team-name">${pred.home}</div><div class="team-record">${homeRecord}</div></div>
                                ${homeLogo ? `<img src="${homeLogo}" class="team-logo">` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="game-body">
                        <div class="winner-section">
                            <div class="winner-label">SHARP PICK</div>
                            <div class="winner-name sharp-pick">${pred.winner}</div>
                            <div class="confidence">Dimers: ${pred.dimersPct}% for favored</div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Score Projection</div>
                            <div class="prediction-grid">
                                <div class="pred-stat"><div class="pred-label">${pred.away}</div><div class="pred-value">${pred.awayScore}</div></div>
                                <div class="pred-stat"><div class="pred-label">${pred.home}</div><div class="pred-value">${pred.homeScore}</div></div>
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Betting Lines</div>
                            <div class="stats-breakdown">
                                <div class="stat-row"><span>Spread (${pred.home})</span><strong>${pred.spread}</strong></div>
                                <div class="stat-row"><span>Cover Edge</span><strong>${pred.beatsSpread}</strong></div>
                                <div class="stat-row"><span>Total</span><strong>${pred.total}</strong></div>
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Player Projections</div>
                            <div class="stats-breakdown">
                                <div class="stat-row"><span>${pred.home} QB</span><strong>${pred.homeQBYards} yds, ${pred.homeQBTDs} TD</strong></div>
                                <div class="stat-row"><span>${pred.away} QB</span><strong>${pred.awayQBYards} yds, ${pred.awayQBTDs} TD</strong></div>
                                <div class="stat-row"><span>${pred.home} rush</span><strong>${pred.homeRBYards} yds</strong></div>
                                <div class="stat-row"><span>${pred.away} rush</span><strong>${pred.awayRBYards} yds</strong></div>
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Best Props for This Game</div>
                            <div class="stats-breakdown">
                                ${pred.topProps.map(p => `<div class="stat-row"><strong>${p}</strong></div>`).join('')}
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Key Factors</div>
                            <div class="stats-breakdown">
                                <div class="stat-row"><span>Weather</span><strong>${pred.weather}</strong></div>
                                <div class="stat-row"><span>Key Injuries</span><strong>${pred.keyInjuries}</strong></div>
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        // displayGames same, but sort high confidence first if desired

        if (apiKey) {
            document.getElementById('apiSetup').style.display = 'none';
            loadAllData();
        }
    </script>
</body>
</html>
