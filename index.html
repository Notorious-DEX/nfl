<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL PREDICTIONS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #3d2c5c 0%, #503d72 50%, #3d2c5c 100%); min-height: 100vh; padding: 2rem; color: white; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 3rem; }
        h1 { font-size: 3rem; margin-bottom: 0.5rem; }
        .subtitle { color: #d4c5f9; font-size: 1.2rem; }
        .api-setup { background: rgba(107, 79, 158, 0.3); border: 2px solid #6b4f9e; border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; text-align: center; }
        .api-setup h3 { margin-bottom: 1rem; font-size: 1.5rem; }
        .api-setup p { margin-bottom: 1.5rem; font-size: 1.1rem; }
        .api-setup input { width: 70%; max-width: 500px; padding: 1rem; border-radius: 0.5rem; border: none; background: rgba(255, 255, 255, 0.1); color: white; font-size: 1.2rem; }
        .api-setup button { margin-top: 1.5rem; padding: 1rem 3rem; border-radius: 0.5rem; border: none; background: #6b4f9e; color: white; font-weight: bold; font-size: 1.2rem; cursor: pointer; }
        .api-setup button:hover { background: #7c5caf; }
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 2rem; }
        .game-card { border-radius: 1.5rem; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.4); transition: transform 0.3s ease; }
        .game-card:hover { transform: translateY(-5px); }
        .game-header { padding: 2rem; }
        .game-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .game-time { font-weight: 600; font-size: 1.1rem; }
        .badge { background: rgba(255,255,255,0.2); padding: 0.4rem 1rem; border-radius: 2rem; font-size: 0.85rem; font-weight: bold; }
        .confidence-high { background: #10b981; }
        .confidence-medium { background: #f59e0b; }
        .confidence-low { background: #ef4444; }
        .teams { display: flex; justify-content: space-between; align-items: center; }
        .team { display: flex; align-items: center; gap: 1rem; }
        .team-logo { width: 64px; height: 64px; }
        .team-name { font-size: 1.3rem; font-weight: bold; }
        .team-record { opacity: 0.8; font-size: 0.9rem; }
        .vs { font-size: 2rem; font-weight: bold; opacity: 0.8; }
        .game-body { padding: 2rem; background: rgba(31, 41, 55, 0.5); }
        .prediction-section { background: rgba(107, 79, 158, 0.3); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; }
        .prediction-title { color: #d4c5f9; font-size: 0.9rem; margin-bottom: 1rem; font-weight: 600; }
        .prediction-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .pred-stat { background: rgba(55, 65, 81, 0.5); padding: 1rem; border-radius: 0.75rem; text-align: center; }
        .pred-label { color: #9ca3af; font-size: 0.85rem; margin-bottom: 0.5rem; }
        .pred-value { font-size: 1.8rem; font-weight: bold; }
        .winner-section { text-align: center; margin-bottom: 1.5rem; }
        .winner-label { color: #9ca3af; font-size: 0.85rem; margin-bottom: 0.5rem; }
        .winner-name { font-size: 2rem; font-weight: bold; color: #10b981; }
        .confidence { font-size: 1rem; color: #d4c5f9; margin-top: 0.5rem; }
        .stats-breakdown { display: grid; gap: 0.75rem; }
        .stat-row { display: flex; justify-content: space-between; background: rgba(55, 65, 81, 0.3); padding: 0.75rem; border-radius: 0.5rem; }
        .loading { text-align: center; padding: 4rem; font-size: 1.5rem; }
        .error { background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem; text-align: center; display: none; }
        .sharp-pick { font-size: 1.5rem; font-weight: bold; color: #10b981; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèà NFL PREDICTIONS</h1>
            <p class="subtitle">Sharp Bets: Odds, Dimers Consensus, Weather, Injuries, Props</p>
        </header>

        <div class="api-setup" id="apiSetup">
            <h3>üîë The Odds API Key Required</h3>
            <p>Get your free key at <a href="https://the-odds-api.com" target="_blank">the-odds-api.com</a></p>
            <input type="text" id="apiKeyInput" placeholder="Enter your API key here" />
            <button onclick="saveApiKey()">Save & Load Predictions</button>
        </div>

        <div id="error" class="error"></div>
        <div id="loading" class="loading">Enter your API key above to load games...</div>
        <div id="games" class="games-grid"></div>
    </div>

    <script>
        const TEAM_DATA = {
            "Arizona Cardinals": { colors: ["#97233F", "#FFB612"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ari.png" },
            "Atlanta Falcons": { colors: ["#A71930", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/atl.png" },
            "Baltimore Ravens": { colors: ["#241773", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/bal.png" },
            "Buffalo Bills": { colors: ["#00338D", "#C60C30"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/buf.png" },
            "Carolina Panthers": { colors: ["#0085CA", "#101820"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/car.png" },
            "Chicago Bears": { colors: ["#0B162A", "#C83803"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/chi.png" },
            "Cincinnati Bengals": { colors: ["#FB4F14", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/cin.png" },
            "Cleveland Browns": { colors: ["#311D00", "#FF3C00"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/cle.png" },
            "Dallas Cowboys": { colors: ["#041E42", "#869397"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/dal.png" },
            "Denver Broncos": { colors: ["#FB4F14", "#002244"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/den.png" },
            "Detroit Lions": { colors: ["#0076B6", "#B0B7BC"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/det.png" },
            "Green Bay Packers": { colors: ["#203731", "#FFB612"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/gb.png" },
            "Houston Texans": { colors: ["#03202F", "#A71930"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/hou.png" },
            "Indianapolis Colts": { colors: ["#002C5F", "#A2AAAD"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ind.png" },
            "Jacksonville Jaguars": { colors: ["#006778", "#D7A22A"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/jax.png" },
            "Kansas City Chiefs": { colors: ["#E31837", "#FFB81C"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/kc.png" },
            "Las Vegas Raiders": { colors: ["#000000", "#A5ACAF"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/lv.png" },
            "Los Angeles Chargers": { colors: ["#0080C6", "#FFC20E"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/lac.png" },
            "Los Angeles Rams": { colors: ["#003594", "#FFA300"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/lar.png" },
            "Miami Dolphins": { colors: ["#008E97", "#FC4C02"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/mia.png" },
            "Minnesota Vikings": { colors: ["#4F2683", "#FFC62F"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/min.png" },
            "New England Patriots": { colors: ["#002244", "#C60C30"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ne.png" },
            "New Orleans Saints": { colors: ["#D3BC8D", "#101820"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/no.png" },
            "New York Giants": { colors: ["#0B2265", "#A71930"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png" },
            "New York Jets": { colors: ["#125740", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/nyj.png" },
            "Philadelphia Eagles": { colors: ["#004C54", "#A5ACAF"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/phi.png" },
            "Pittsburgh Steelers": { colors: ["#FFB612", "#101820"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/pit.png" },
            "San Francisco 49ers": { colors: ["#AA0000", "#B3995D"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/sf.png" },
            "Seattle Seahawks": { colors: ["#002244", "#69BE28"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/sea.png" },
            "Tampa Bay Buccaneers": { colors: ["#D50A0A", "#34302B"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/tb.png" },
            "Tennessee Titans": { colors: ["#0C2340", "#4B92DB"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ten.png" },
            "Washington Commanders": { colors: ["#5A1414", "#FFB612"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png" }
        };

        const FIELD_TYPE = {
            "ARI": "grass", "ATL": "turf", "BAL": "grass", "BUF": "turf", "CAR": "turf", "CHI": "grass",
            "CIN": "turf", "CLE": "grass", "DAL": "turf", "DEN": "grass", "DET": "turf", "GB": "grass",
            "HOU": "turf", "IND": "turf", "JAX": "grass", "KC": "grass", "LV": "turf", "LAC": "turf",
            "LAR": "turf", "MIA": "grass", "MIN": "turf", "NE": "turf", "NO": "turf", "NYG": "turf",
            "NYJ": "turf", "PHI": "grass", "PIT": "grass", "SF": "grass", "SEA": "turf", "TB": "grass",
            "TEN": "turf", "WSH": "grass"
        };

        const GAME_INFO = {
            "Philadelphia Eagles": { away: "Las Vegas Raiders", dimersPct: 88, weather: "Cold, possible snow", field: FIELD_TYPE["PHI"], qbHome: "Jalen Hurts", rbHome: "Saquon Barkley", qbAway: "Aidan O'Connell", rbAway: "Sincere McCormick", topProps: ["Hurts anytime TD", "Barkley O 80.5 rush yds", "Eagles -11.5"] },
            "Seattle Seahawks": { away: "Indianapolis Colts", dimersPct: 89, weather: "Dome", field: FIELD_TYPE["SEA"], qbHome: "Geno Smith", rbHome: "Kenneth Walker", qbAway: "Anthony Richardson", rbAway: "Jonathan Taylor", topProps: ["Seahawks -13.5", "Taylor U 80.5 rush yds", "DK Metcalf O rec yds"] },
            "San Francisco 49ers": { away: "Tennessee Titans", dimersPct: 87, weather: "Mild", field: FIELD_TYPE["SF"], qbHome: "Brock Purdy", rbHome: "Christian McCaffrey", qbAway: "Will Levis", rbAway: "Tony Pollard", topProps: ["49ers -12.5", "McCaffrey O rush yds"] },
            "Houston Texans": { away: "Arizona Cardinals", dimersPct: 82, weather: "Dome", field: FIELD_TYPE["HOU"], qbHome: "C.J. Stroud", rbHome: "Joe Mixon", qbAway: "Kyler Murray", rbAway: "James Conner", topProps: ["Texans -10", "Stroud O passing yds"] },
            "Chicago Bears": { away: "Cleveland Browns", dimersPct: 78, weather: "Frigid 10¬∞F", field: FIELD_TYPE["CHI"], qbHome: "Caleb Williams", rbHome: "D'Andre Swift", qbAway: "Jameis Winston", rbAway: "Nick Chubb", topProps: ["Bears team total O", "Swift O rush yds"] },
            "Dallas Cowboys": { away: "Minnesota Vikings", dimersPct: 73, weather: "Dome", field: FIELD_TYPE["DAL"], qbHome: "Dak Prescott", rbHome: "Rico Dowdle", qbAway: "Sam Darnold", rbAway: "Aaron Jones", topProps: ["Cowboys -5.5", "CeeDee Lamb O rec yds"] },
            "Kansas City Chiefs": { away: "Los Angeles Chargers", dimersPct: 71, weather: "Mild", field: FIELD_TYPE["KC"], qbHome: "Patrick Mahomes", rbHome: "Isiah Pacheco", qbAway: "Justin Herbert", rbAway: "J.K. Dobbins", topProps: ["Mahomes O 1.5 TD", "Chiefs ML"] },
            "Los Angeles Rams": { away: "Detroit Lions", dimersPct: 68, weather: "Dome", field: FIELD_TYPE["LAR"], qbHome: "Matthew Stafford", rbHome: "Kyren Williams", qbAway: "Jared Goff", rbAway: "Jahmyr Gibbs", topProps: ["Rams -6", "Gibbs O rush yds"] },
            "Jacksonville Jaguars": { away: "New York Jets", dimersPct: 90, weather: "Mild", field: FIELD_TYPE["JAX"], qbHome: "Trevor Lawrence", rbHome: "Travis Etienne", qbAway: "Aaron Rodgers", rbAway: "Breece Hall", topProps: ["Jaguars cover", "Etienne O rush yds"] }
            // Add others as needed
        };

        let apiKey = localStorage.getItem('nfl_odds_api_key') || '';
        let teamStats = {};

        function saveApiKey() {
            apiKey = document.getElementById('apiKeyInput').value.trim();
            if (apiKey) {
                localStorage.setItem('nfl_odds_api_key', apiKey);
                document.getElementById('apiSetup').style.display = 'none';
                loadAllData();
            } else showError('Valid key required');
        }

        function showError(msg) {
            const el = document.getElementById('error');
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        async function loadAllData() {
            if (!apiKey) return;
            document.getElementById('loading').textContent = 'Loading...';
            try {
                await fetchTeamStats();
                await fetchGamesAndOdds();
            } catch (e) {
                showError('Load failed');
            }
        }

        async function fetchTeamStats() {
            const res = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/teams');
            const data = await res.json();
            teamStats = {};
            data.sports[0].leagues[0].teams.forEach(t => {
                teamStats[t.team.displayName] = { record: t.team.record?.items?.[0]?.summary || '0-0' };
            });
        }

        async function fetchGamesAndOdds() {
            const games = [];
            const today = new Date();
            for (let i = 0; i < 7; i++) {
                const d = new Date(today);
                d.setDate(d.getDate() + i);
                const ds = d.toISOString().split('T')[0].replace(/-/g, '');
                const res = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard?dates=${ds}`);
                const json = await res.json();
                if (json.events) games.push(...json.events);
            }

            let oddsData = [];
            try {
                const res = await fetch(`https://api.the-odds-api.com/v4/sports/americanfootball_nfl/odds?regions=us&markets=h2h,spreads,totals&oddsFormat=american&apiKey=${apiKey}`);
                if (res.ok) oddsData = await res.json();
            } catch {}

            const predArray = games.map(g => ({
                g,
                pred: generatePrediction(g, oddsData.find(o => o.home_team === g.competitions[0].competitors.find(c => c.homeAway === 'home')?.team.displayName && o.away_team === g.competitions[0].competitors.find(c => c.homeAway === 'away')?.team.displayName))
            }));

            predArray.sort((a, b) => {
                const conf = { 'High': 3, 'Medium': 2, 'Low': 1 };
                return conf[b.pred.confidence] - conf[a.pred.confidence];
            });

            displayGames(predArray.map(item => item.g), predArray.map(item => item.pred));
        }

        function generatePrediction(game, oddsGame) {
            const comp = game.competitions[0];
            const home = comp.competitors.find(c => c.homeAway === 'home')?.team.displayName;
            const away = comp.competitors.find(c => c.homeAway === 'away')?.team.displayName;

            let spread = 'N/A', total = 'N/A';
            if (oddsGame?.bookmakers?.[0]) {
                const bk = oddsGame.bookmakers[0];
                const spreads = bk.markets.find(m => m.key === 'spreads');
                const totals = bk.markets.find(m => m.key === 'totals');
                if (spreads) spread = spreads.outcomes.find(o => o.name === home)?.point || 'N/A';
                if (totals) total = totals.outcomes[0]?.point || 'N/A';
            }

            const totalVal = total !== 'N/A' ? parseFloat(total) : 45;
            const spreadVal = spread !== 'N/A' ? parseFloat(spread) : 0;
            let homeScore = Math.round(totalVal / 2 + spreadVal / 2 + Math.random() * 3 - 1.5);
            let awayScore = Math.round(totalVal / 2 - spreadVal / 2 + Math.random() * 3 - 1.5);

            const info = GAME_INFO[home] || {};
            const dimersPct = info.dimersPct || 50;
            const bias = (dimersPct - 50) * 0.2;
            homeScore += Math.round(bias * 10);
            awayScore -= Math.round(bias * 10);

            homeScore = Math.max(10, homeScore);
            awayScore = Math.max(10, awayScore);

            const margin = Math.abs(homeScore - awayScore);
            const winner = homeScore > awayScore ? home : away;
            const confidence = margin > 12 ? 'High' : margin > 6 ? 'Medium' : 'Low';
            const winnerColor = TEAM_DATA[winner]?.colors[0] || '#6b4f9e';

            return {
                home, away, homeScore, awayScore, winner, confidence, spread, total,
                beatsSpread: spread !== 'N/A' ? (homeScore - awayScore > -spreadVal ? `${home} covers` : `${away} covers`) : 'N/A',
                qbHome: info.qbHome || 'QB', rbHome: info.rbHome || 'RB',
                qbAway: info.qbAway || 'QB', rbAway: info.rbAway || 'RB',
                homeQBYards: Math.round(homeScore * 11 + Math.random() * 50), homeQBTDs: Math.max(1, Math.floor(homeScore / 8)),
                awayQBYards: Math.round(awayScore * 11 + Math.random() * 50), awayQBTDs: Math.max(1, Math.floor(awayScore / 8)),
                homeRBYards: Math.round(homeScore * 5 + Math.random() * 40), awayRBYards: Math.round(awayScore * 5 + Math.random() * 40),
                dimersPct, winnerColor, weather: info.weather || 'Standard', field: info.field || 'turf',
                topProps: info.topProps || ['Check lines']
            };
        }

        function createGameCard(game, pred) {
            const homeLogo = TEAM_DATA[pred.home]?.logo || '';
            const awayLogo = TEAM_DATA[pred.away]?.logo || '';
            const homeRecord = teamStats[pred.home]?.record || '';
            const awayRecord = teamStats[pred.away]?.record || '';
            const time = new Date(game.date).toLocaleString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' });

            return `
                <div class="game-card" style="background: linear-gradient(135deg, ${pred.winnerColor}22 0%, ${pred.winnerColor}44 100%);">
                    <div class="game-header" style="background-color: ${pred.winnerColor}ee;">
                        <div class="game-meta">
                            <div class="game-time">${time}</div>
                            <div class="badge confidence-${pred.confidence.toLowerCase()}">${pred.confidence.toUpperCase()}</div>
                        </div>
                        <div class="teams">
                            <div class="team">
                                ${awayLogo ? `<img src="${awayLogo}" class="team-logo">` : ''}
                                <div><div class="team-name">${pred.away}</div><div class="team-record">${awayRecord}</div></div>
                            </div>
                            <div class="vs">@</div>
                            <div class="team">
                                <div style="text-align: right;"><div class="team-name">${pred.home}</div><div class="team-record">${homeRecord}</div></div>
                                ${homeLogo ? `<img src="${homeLogo}" class="team-logo">` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="game-body">
                        <div class="winner-section">
                            <div class="winner-label">SHARP PICK</div>
                            <div class="winner-name sharp-pick">${pred.winner}</div>
                            <div class="confidence">Dimers home win: ${pred.dimersPct}%</div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Score Projection</div>
                            <div class="prediction-grid">
                                <div class="pred-stat"><div class="pred-label">${pred.away}</div><div class="pred-value">${pred.awayScore}</div></div>
                                <div class="pred-stat"><div class="pred-label">${pred.home}</div><div class="pred-value">${pred.homeScore}</div></div>
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Betting Lines</div>
                            <div class="stats-breakdown">
                                <div class="stat-row"><span>Spread (${pred.home})</span><strong>${pred.spread}</strong></div>
                                <div class="stat-row"><span>Cover Edge</span><strong>${pred.beatsSpread}</strong></div>
                                <div class="stat-row"><span>Total</span><strong>${pred.total}</strong></div>
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Player Projections</div>
                            <div class="stats-breakdown">
                                <div class="stat-row"><span>${pred.home} QB (${pred.qbHome})</span><strong>${pred.homeQBYards} yds, ${pred.homeQBTDs} TD</strong></div>
                                <div class="stat-row"><span>${pred.away} QB (${pred.qbAway})</span><strong>${pred.awayQBYards} yds, ${pred.awayQBTDs} TD</strong></div>
                                <div class="stat-row"><span>${pred.home} RB (${pred.rbHome})</span><strong>${pred.homeRBYards} yds</strong></div>
                                <div class="stat-row"><span>${pred.away} RB (${pred.rbAway})</span><strong>${pred.awayRBYards} yds</strong></div>
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Best Props for This Game</div>
                            <div class="stats-breakdown">
                                ${pred.topProps.map(p => `<div class="stat-row"><strong>${p}</strong></div>`).join('')}
                            </div>
                        </div>
                        <div class="prediction-section">
                            <div class="prediction-title">Key Factors</div>
                            <div class="stats-breakdown">
                                <div class="stat-row"><span>Weather</span><strong>${pred.weather}</strong></div>
                                <div class="stat-row"><span>Field Type</span><strong>${pred.field}</strong></div>
                            </div>
                        </div>
                    </div>
                </div>`;
        }

        function displayGames(games, preds) {
            const container = document.getElementById('games');
            container.innerHTML = '';
            document.getElementById('loading').style.display = 'none';
            if (games.length === 0) {
                container.innerHTML = '<div style="text-align:center;padding:4rem;">No games</div>';
                return;
            }
            games.forEach((g, i) => {
                container.innerHTML += createGameCard(g, preds[i]);
            });
        }

        if (apiKey) {
            document.getElementById('apiSetup').style.display = 'none';
            loadAllData();
        }
    </script>
</body>
</html>
