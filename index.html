<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Prediction AI - Real Data</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #3d2c5c 0%, #503d72 50%, #3d2c5c 100%);
            min-height: 100vh;
            padding: 2rem;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .subtitle {
            color: #d4c5f9;
            font-size: 1.2rem;
        }

        .api-setup {
            background: rgba(107, 79, 158, 0.3);
            border: 2px solid #6b4f9e;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .api-setup input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .api-setup button {
            margin-top: 0.5rem;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            border: none;
            background: #6b4f9e;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .api-setup button:hover {
            background: #7c5caf;
        }

        .scoreboard {
            background: linear-gradient(135deg, #6b4f9e 0%, #7c5caf 100%);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .scoreboard-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .stats {
            display: flex;
            gap: 3rem;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .stat-label {
            color: #f3f0ff;
            font-size: 0.9rem;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
        }

        .game-card {
            border-radius: 1.5rem;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            transition: transform 0.3s ease;
        }

        .game-card:hover {
            transform: translateY(-5px);
        }

        .game-header {
            padding: 2rem;
        }

        .game-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .game-time {
            font-weight: 600;
        }

        .badge {
            background: rgba(255,255,255,0.2);
            padding: 0.4rem 1rem;
            border-radius: 2rem;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .team-logo {
            width: 64px;
            height: 64px;
        }

        .team-name {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .team-record {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .vs {
            font-size: 2rem;
            font-weight: bold;
            opacity: 0.8;
        }

        .game-body {
            padding: 2rem;
            background: rgba(31, 41, 55, 0.5);
        }

        .prediction-section {
            background: rgba(107, 79, 158, 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .prediction-title {
            color: #d4c5f9;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .prediction-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .pred-stat {
            background: rgba(55, 65, 81, 0.5);
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        .pred-label {
            color: #9ca3af;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .pred-value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .winner-section {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .winner-label {
            color: #9ca3af;
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .winner-name {
            font-size: 2rem;
            font-weight: bold;
            color: #10b981;
        }

        .confidence {
            font-size: 1rem;
            color: #d4c5f9;
            margin-top: 0.5rem;
        }

        .loading {
            text-align: center;
            padding: 4rem;
            font-size: 1.5rem;
        }

        .error {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .stats-breakdown {
            display: grid;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            background: rgba(55, 65, 81, 0.3);
            padding: 0.75rem;
            border-radius: 0.5rem;
        }

        .injuries {
            background: rgba(239, 68, 68, 0.2);
            border-left: 3px solid #ef4444;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }

        .injury-title {
            font-weight: 600;
            color: #fca5a5;
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span>üèà</span>
                NFL PREDICTION AI
            </h1>
            <p class="subtitle">Real Data ‚Ä¢ Live Odds ‚Ä¢ Injury Reports</p>
        </header>

        <div class="api-setup">
            <h3 style="margin-bottom: 1rem;">üîë The Odds API Key (Required)</h3>
            <p style="margin-bottom: 1rem; color: #d4c5f9; font-size: 0.9rem;">
                Get your free API key from <a href="https://the-odds-api.com/" target="_blank" style="color: #a78bfa;">the-odds-api.com</a>
            </p>
            <input type="text" id="apiKeyInput" placeholder="Enter your API key here" />
            <button onclick="saveApiKey()">Save & Load Predictions</button>
        </div>

        <div class="scoreboard">
            <div class="scoreboard-content">
                <div>
                    <h2>üìà Prediction Accuracy</h2>
                    <p style="color: #f3f0ff;">Season Performance Tracker</p>
                </div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="correct">0</div>
                        <div class="stat-label">Correct</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="total">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="error" class="error" style="display: none;"></div>
        <div id="loading" class="loading">Enter your API key to load predictions...</div>
        <div id="games" class="games-grid"></div>
    </div>

    <script>
        const TEAM_DATA = {
            "Arizona Cardinals": { colors: ["#97233F", "#FFB612"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ari.png" },
            "Atlanta Falcons": { colors: ["#A71930", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/atl.png" },
            "Baltimore Ravens": { colors: ["#241773", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/bal.png" },
            "Buffalo Bills": { colors: ["#00338D", "#C60C30"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/buf.png" },
            "Carolina Panthers": { colors: ["#0085CA", "#101820"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/car.png" },
            "Chicago Bears": { colors: ["#0B162A", "#C83803"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/chi.png" },
            "Cincinnati Bengals": { colors: ["#FB4F14", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/cin.png" },
            "Cleveland Browns": { colors: ["#311D00", "#FF3C00"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/cle.png" },
            "Dallas Cowboys": { colors: ["#041E42", "#869397"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/dal.png" },
            "Denver Broncos": { colors: ["#FB4F14", "#002244"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/den.png" },
            "Detroit Lions": { colors: ["#0076B6", "#B0B7BC"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/det.png" },
            "Green Bay Packers": { colors: ["#203731", "#FFB612"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/gb.png" },
            "Houston Texans": { colors: ["#03202F", "#A71930"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/hou.png" },
            "Indianapolis Colts": { colors: ["#002C5F", "#A2AAAD"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ind.png" },
            "Jacksonville Jaguars": { colors: ["#006778", "#D7A22A"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/jax.png" },
            "Kansas City Chiefs": { colors: ["#E31837", "#FFB81C"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/kc.png" },
            "Las Vegas Raiders": { colors: ["#000000", "#A5ACAF"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/lv.png" },
            "Los Angeles Chargers": { colors: ["#0080C6", "#FFC20E"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/lac.png" },
            "Los Angeles Rams": { colors: ["#003594", "#FFA300"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/lar.png" },
            "Miami Dolphins": { colors: ["#008E97", "#FC4C02"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/mia.png" },
            "Minnesota Vikings": { colors: ["#4F2683", "#FFC62F"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/min.png" },
            "New England Patriots": { colors: ["#002244", "#C60C30"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ne.png" },
            "New Orleans Saints": { colors: ["#D3BC8D", "#101820"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/no.png" },
            "New York Giants": { colors: ["#0B2265", "#A71930"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png" },
            "New York Jets": { colors: ["#125740", "#000000"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/nyj.png" },
            "Philadelphia Eagles": { colors: ["#004C54", "#A5ACAF"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/phi.png" },
            "Pittsburgh Steelers": { colors: ["#FFB612", "#101820"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/pit.png" },
            "San Francisco 49ers": { colors: ["#AA0000", "#B3995D"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/sf.png" },
            "Seattle Seahawks": { colors: ["#002244", "#69BE28"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/sea.png" },
            "Tampa Bay Buccaneers": { colors: ["#D50A0A", "#34302B"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/tb.png" },
            "Tennessee Titans": { colors: ["#0C2340", "#4B92DB"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/ten.png" },
            "Washington Commanders": { colors: ["#5A1414", "#FFB612"], logo: "https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png" }
        };

        let apiKey = localStorage.getItem('nfl_odds_api_key');
        let teamStats = {};
        let injuries = {};

        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            apiKey = input.value.trim();
            if (apiKey) {
                localStorage.setItem('nfl_odds_api_key', apiKey);
                loadAllData();
            } else {
                showError('Please enter a valid API key');
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => errorEl.style.display = 'none', 5000);
        }

        async function loadAllData() {
            if (!apiKey) {
                document.getElementById('loading').textContent = 'Please enter your API key above';
                return;
            }

            document.getElementById('loading').textContent = 'Loading games, odds, and stats...';
            document.getElementById('error').style.display = 'none';

            try {
                // Fetch games and team stats
                await Promise.all([
                    fetchGames(),
                    fetchTeamStats(),
                    fetchInjuries()
                ]);
            } catch (error) {
                showError('Error loading data: ' + error.message);
                document.getElementById('loading').textContent = 'Error loading data. Check console.';
            }
        }

        async function fetchGames() {
            const allGames = [];
            const today = new Date();
            
            for (let i = 0; i < 3; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0].replace(/-/g, '');
                
                const response = await fetch(
                    `https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard?dates=${dateStr}`
                );
                const data = await response.json();
                
                if (data.events) {
                    allGames.push(...data.events);
                }
            }
            
            if (allGames.length > 0) {
                await fetchOddsAndDisplay(allGames);
            } else {
                document.getElementById('loading').textContent = 'No upcoming games in next 3 days';
            }
        }

        async function fetchOddsAndDisplay(games) {
            try {
                const oddsResponse = await fetch(
                    `https://api.the-odds-api.com/v4/sports/americanfootball_nfl/odds?regions=us&markets=h2h,spreads,totals&oddsFormat=american&apiKey=${apiKey}`
                );
                
                if (!oddsResponse.ok) {
                    throw new Error('Failed to fetch odds. Check your API key.');
                }
                
                const oddsData = await oddsResponse.json();
                displayGames(games, oddsData);
            } catch (error) {
                showError(error.message);
                displayGames(games, []);
            }
        }

        async function fetchTeamStats() {
            try {
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/teams');
                const data = await response.json();
                
                for (const team of data.sports[0].leagues[0].teams) {
                    const teamName = team.team.displayName;
                    teamStats[teamName] = {
                        record: team.team.record?.items?.[0]?.summary || 'N/A',
                        standing: team.team.standingSummary || ''
                    };
                }
            } catch (error) {
                console.error('Error fetching team stats:', error);
            }
        }

        async function fetchInjuries() {
            // Note: ESPN injury endpoints are limited, this is a basic implementation
            // In production, you'd want a more comprehensive injury data source
            injuries = {};
        }

        function generateSmartPrediction(game, odds) {
            const homeTeam = game.competitions[0].competitors[0].team.displayName;
            const awayTeam = game.competitions[0].competitors[1].team.displayName;
            
            let prediction = {
                homeTeam,
                awayTeam,
                spread: 'N/A',
                total: 'N/A',
                homeMoneyline: 'N/A',
                awayMoneyline: 'N/A'
            };

            // Get odds if available
            if (odds) {
                const spreadsMarket = odds.bookmakers?.[0]?.markets?.find(m => m.key === 'spreads');
                const totalsMarket = odds.bookmakers?.[0]?.markets?.find(m => m.key === 'totals');
                const h2hMarket = odds.bookmakers?.[0]?.markets?.find(m => m.key === 'h2h');

                if (spreadsMarket) {
                    const homeSpread = spreadsMarket.outcomes.find(o => o.name === homeTeam);
                    prediction.spread = homeSpread?.point || 'N/A';
                }

                if (totalsMarket) {
                    prediction.total = totalsMarket.outcomes[0]?.point || 'N/A';
                }

                if (h2hMarket) {
                    const homeML = h2hMarket.outcomes.find(o => o.name === homeTeam);
                    const awayML = h2hMarket.outcomes.find(o => o.name === awayTeam);
                    prediction.homeMoneyline = homeML?.price || 'N/A';
                    prediction.awayMoneyline = awayML?.price || 'N/A';
                }
            }

            // Calculate predicted scores based on spread and total
            if (prediction.spread !== 'N/A' && prediction.total !== 'N/A') {
                const spread = parseFloat(prediction.spread);
                const total = parseFloat(prediction.total);
                
                prediction.homeScore = Math.round((total - spread) / 2);
                prediction.awayScore = Math.round((total + spread) / 2);
            } else {
                // Fallback to average scores
                prediction.homeScore = 24;
                prediction.awayScore = 21;
            }

            // Determine winner and confidence
            if (prediction.homeScore > prediction.awayScore) {
                prediction.winner = homeTeam;
                prediction.confidence = Math.abs(prediction.homeScore - prediction.awayScore) > 7 ? 'High' : 'Medium';
            } else {
                prediction.winner = awayTeam;
                prediction.confidence = Math.abs(prediction.homeScore - prediction.awayScore) > 7 ? 'High' : 'Medium';
            }

            // Calculate stats predictions based on scores
            prediction.homeQBYards = Math.round(prediction.homeScore * 11);
            prediction.homeQBTDs = Math.max(1, Math.floor(prediction.homeScore / 8));
            prediction.awayQBYards = Math.round(prediction.awayScore * 11);
            prediction.awayQBTDs = Math.max(1, Math.floor(prediction.awayScore / 8));
            prediction.homeRBYards = Math.round(prediction.homeScore * 4);
            prediction.awayRBYards = Math.round(prediction.awayScore * 4);
            
            // Beats spread prediction
            if (prediction.spread !== 'N/A') {
                const actualMargin = prediction.homeScore - prediction.awayScore;
                prediction.beatsSpread = actualMargin > parseFloat(prediction.spread) ? 'Yes' : 'No';
            } else {
                prediction.beatsSpread = 'N/A';
            }

            return prediction;
        }

        function displayGames(games, oddsData) {
            const gamesContainer = document.getElementById('games');
            const loadingEl = document.getElementById('loading');
            
            loadingEl.style.display = 'none';
            gamesContainer.innerHTML = '';
            
            if (games.length === 0) {
                gamesContainer.innerHTML = '<div style="text-align: center; grid-column: 1/-1; padding: 4rem;">No upcoming games in next 3 days</div>';
                return;
            }
            
            games.forEach(game => {
                const homeTeam = game.competitions[0].competitors[0].team.displayName;
                const awayTeam = game.competitions[0].competitors[1].team.displayName;
                
                // Find matching odds
                const gameOdds = oddsData.find(o => 
                    o.home_team === homeTeam && o.away_team === awayTeam
                );
                
                const prediction = generateSmartPrediction(game, gameOdds);
                gamesContainer.innerHTML += createGameCard(game, prediction);
            });
        }

        function createGameCard(game, prediction) {
            const teamColor = TEAM_DATA[prediction.homeTeam]?.colors[0] || '#6b4f9e';
            const homeLogo = TEAM_DATA[prediction.homeTeam]?.logo;
            const awayLogo = TEAM_DATA[prediction.awayTeam]?.logo;
            const homeRecord = teamStats[prediction.homeTeam]?.record || '';
            const awayRecord = teamStats[prediction.awayTeam]?.record || '';

            const gameDate = new Date(game.date);
            const gameTime = gameDate.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });

            return `
                <div class="game-card" style="background: linear-gradient(135deg, ${teamColor}22 0%, ${teamColor}44 100%); border: 2px solid ${teamColor}88;">
                    <div class="game-header" style="background-color: ${teamColor}ee;">
                        <div class="game-meta">
                            <div class="game-time">üìÖ ${gameTime}</div>
                            <div class="badge">REAL DATA PREDICTION</div>
                        </div>
                        <div class="teams">
                            <div class="team">
                                ${awayLogo ? `<img src="${awayLogo}" alt="${prediction.awayTeam}" class="team-logo">` : ''}
                                <div>
                                    <div class="team-name">${prediction.awayTeam}</div>
                                    <div class="team-record">${awayRecord}</div>
                                </div>
                            </div>
                            <div class="vs">@</div>
                            <div class="team">
                                <div style="text-align: right;">
                                    <div class="team-name">${prediction.homeTeam}</div>
                                    <div class="team-record">${homeRecord}</div>
                                </div>
                                ${homeLogo ? `<img src="${homeLogo}" alt="${prediction.homeTeam}" class="team-logo">` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="game-body">
                        <div class="winner-section">
                            <div class="winner-label">üéØ PREDICTED WINNER</div>
                            <div class="winner-name">${prediction.winner}</div>
                            <div class="confidence">Confidence: ${prediction.confidence}</div>
                        </div>
                        
                        <div class="prediction-section">
                            <div class="prediction-title">üìä Score Prediction</div>
                            <div class="prediction-grid">
                                <div class="pred-stat">
                                    <div class="pred-label">${prediction.homeTeam}</div>
                                    <div class="pred-value">${prediction.homeScore}</div>
                                </div>
                                <div class="pred-stat">
                                    <div class="pred-label">${prediction.awayTeam}</div>
                                    <div class="pred-value">${prediction.awayScore}</div>
                                </div>
                            </div>
                        </div>

                        <div class="prediction-section">
                            <div class="prediction-title">üí∞ Betting Lines</div>
                            <div class="stats-breakdown">
                                <div class="stat-row">
                                    <span>Spread:</span>
                                    <strong>${prediction.homeTeam} ${prediction.spread}</strong>
                                </div>
                                <div class="stat-row">
                                    <span>Over/Under:</span>
                                    <strong>${prediction.total}</strong>
                                </div>
                                <div class="stat-row">
                                    <span>Beats Spread:</span>
                                    <strong>${prediction.beatsSpread}</strong>
                                </div>
                                <div class="stat-row">
                                    <span>Moneyline:</span>
                                    <strong>${prediction.homeTeam} ${prediction.homeMoneyline} / ${prediction.awayTeam} ${prediction.awayMoneyline}</strong>
                                </div>
                            </div>
                        </div>

                        <div class="prediction-section">
                            <div class="prediction-title">üèà Player Stats Predictions</div>
                            <div class="stats-breakdown">
                                <div class="stat-row">
                                    <span>${prediction.homeTeam} QB:</span>
                                    <strong>${prediction.homeQBYards} yds, ${prediction.homeQBTDs} TDs</strong>
                                </div>
                                <div class="stat-row">
                                    <span>${prediction.awayTeam} QB:</span>
                                    <strong>${prediction.awayQBYards} yds, ${prediction.awayQBTDs} TDs</strong>
                                </div>
                                <div class="stat-row">
                                    <span>${prediction.homeTeam} RB:</span>
                                    <strong>${prediction.homeRBYards} rush yds</strong>
                                </div>
                                <div class="stat-row">
                                    <span>${prediction.awayTeam} RB:</span>
                                    <strong>${prediction.awayRBYards} rush yds</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Auto-load if API key exists
        if (apiKey) {
            document.getElementById('apiKeyInput').value = apiKey;
            loadAllData();
        }
    </script>
</body>
</html>
